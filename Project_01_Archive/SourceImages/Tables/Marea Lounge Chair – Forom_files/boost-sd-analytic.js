(()=>{"use strict";const t="boostSDAnalytics",e="boostSDSessionId",o={VIEW_PRODUCT:"view_product",QUICK_VIEW:"quick_view",ADD_TO_CART:"add_to_cart",BUY_NOW:"buy_now"},n="filter",r="search",i="suggest",l="recommend",c="boostSDRequestIdProductClickedKey",s="boostSDRecommendationActiveKey",d="boostSdDataNotSent";var a,u,v,g,p,f,m,b;const S="boost-sd__",y=`.${S}suggestion-queries-item--product`,_=`.${S}product-item, .${S}product-item-list-view-layout`,D=`.${S}recommendation`,A=`.${S}btn-quick-view`,h=(null===(u=boostSDAppConfig)||void 0===u||null===(a=u.analytics)||void 0===a?void 0:a.selectorAddToCart)?null===(g=boostSDAppConfig)||void 0===g||null===(v=g.analytics)||void 0===v?void 0:v.selectorAddToCart:`.${S}btn-add-to-cart, form[action="/cart/add"] *[type="submit"], form[action="/cart/add"] *[name="add"]`,I=(null===(f=boostSDAppConfig)||void 0===f||null===(p=f.analytics)||void 0===p?void 0:p.selectorBuyNow)?null===(b=boostSDAppConfig)||void 0===b||null===(m=b.analytics)||void 0===m?void 0:m.selectorBuyNow:`.${S}btn-buy-now, .shopify-payment-button__button, .shopify-payment-button, #dynamic-checkout-cart`,O=`.${S}quick-view`;function x(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function k(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})))),n.forEach((function(e){x(t,e,o[e])}))}return t}var w="";const C=localStorage.getItem(e);var T=C?null==C?void 0:C.replaceAll('"',""):"";C&&(null==C?void 0:C.includes(""))&&localStorage.setItem(e,null==C?void 0:C.replaceAll('"',""));const R=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})),N=t=>{try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(t){return null}},q=(t,e)=>{try{null!=e?localStorage.setItem(t,JSON.stringify(e)):localStorage.setItem(t,"")}catch(t){}},j=()=>{var t,e;return"collection"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)},E=()=>{var t,e;return"search"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)},U=()=>{var t,e;return"product"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)},W=()=>{let t="";switch(!0){case j():t="collection_page";break;case E():t="search_page";break;case U():t="product_page";break;case(()=>{var t,e;return"cart"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)})():t="cart_page";break;case(()=>{var t,e;return"index"===(null===(e=boostSDAppConfig)||void 0===e||null===(t=e.generalSettings)||void 0===t?void 0:t.page)})():t="home_page"}return t},P=t=>{const e=N("boostSDRequestIdSaveInfoRequest");return e&&e[t]?e[t]:{query_string:"",action:"filter"}},K=(t,d,a,u={})=>{let v=(null==u?void 0:u.rid)?null==u?void 0:u.rid:((t,e)=>{let o="";switch(e){case n:o="boostSDRequestIdFilterKey";break;case r:o="boostSDRequestIdSearchKey";break;case i:o="boostSDRequestIdSuggestKey";break;case l:o="boostSDRequestIdRecommendationKey"}if(!o)return"";if(e===l){const e=N(s);if(e&&e.pid===t)return e.rid}const c=N(o);if(c){const e=Object.keys(c);for(let o=0;o<e.length;o++){var d;if(null===(d=c[e[o]])||void 0===d?void 0:d.includes(Number(t)))return e[o]}}return""})(t,a);if(a){const e=((t,e=50)=>{let o=N(t)||{};if(Object.keys(o).length>=e){const t={},n=Object.keys(o),r=Object.values(o);for(let o=0;o<e;o++)t[n[o]]=r[o];o=t}return o})(c,3);e[Number(t)]&&delete e[Number(t)];const o=k({[Number(t)]:v},e);q(c,o)}if(!a||!v){const e=N(c);if(!e||!e[Number(t)])return!1;v=e[Number(t)]}const g=P(v).query_string;d===o.QUICK_VIEW&&(d=o.VIEW_PRODUCT),a||(a=P(v).action);let p=!1;if(a===i){(t=>{var e;const o=(N("boostSdSearchResults")||{})[t];var n;return o&&(null==o||null===(e=o.meta)||void 0===e?void 0:e.product_from_semantics)?null==o||null===(n=o.meta)||void 0===n?void 0:n.product_from_semantics:[]})(g).includes(t)&&(p=!0)}const f=w;return k({tid:Shopify.shop,qs:g,eid:R(),rid:v,ct:f||localStorage.getItem("cartToken"),pid:t,t:(new Date).toISOString(),u:d,a:a||"other",r:document.referrer,sid:T||(T=R(),localStorage.setItem(e,T),T),cid:(null===(m=__st)||void 0===m?void 0:m.id)||(null===(S=meta)||void 0===S||null===(b=S.page)||void 0===b?void 0:b.customerId)||(null===(D=ShopifyAnalytics)||void 0===D||null===(_=D.meta)||void 0===_||null===(y=_.page)||void 0===y?void 0:y.customerId)||(null===(O=ShopifyAnalytics)||void 0===O||null===(I=O.lib)||void 0===I||null===(h=I.user())||void 0===h||null===(A=h.traits())||void 0===A?void 0:A.uniqToken),pg:W(),fromSemantics:p},u);var m,b,S,y,_,D,A,h,I,O},B=e=>{var o=N(t);Array.isArray(o)||(o=[]);const n=o.filter((t=>t.pid!=e.productId));n.push(e),q(t,n)};const $=(e,o)=>{var n,r;if(!e.rid)return;const i=(null===(r=window.boostSDAppConfig)||void 0===r||null===(n=r.api)||void 0===n?void 0:n.analyticsUrl)||"https://lambda.mybcapps.com/e";var l,c;if("recommend"===e.a&&["add_to_cart","buy_now"].includes(e.u)&&localStorage.removeItem(s),o)return q(d,e),setTimeout((()=>{return t=e,void fetch("/cart.js").then((t=>t.json())).then((e=>{const o=e.token;w=o,o&&localStorage.setItem("cartToken",o),t&&(t.ct=o,$(t,!1))})).catch((e=>{$(t,!1),console.log("error call refresh cartToken, send tracking without cart token",e)}));var t}),(null===(c=boostSDAppConfig)||void 0===c||null===(l=c.analytics)||void 0===l?void 0:l.timeoutSend)||1200);(async function(t="",e={}){return(await fetch(t,{method:"POST",body:JSON.stringify(e)})).json()})(i,e).then((o=>{""===o.error&&((e=>{var o=N(t);if(Array.isArray(o)){var n=o.filter((t=>t.pid!=e));q(t,n)}})(e.pid),localStorage.removeItem(d))}))};const L=t=>{if(!t||!t.target)return;if("keydown"==t.type&&"Enter"!==t.key)return;const e=t.target.closest(y);if(!e)return;const n=e.getAttribute("data-id");if(!n)return;const r=K(n,o.VIEW_PRODUCT,i);B(r),$(r)};(t=>{if(!t)return null;console.log("register event initInstantSearch"),document.addEventListener("click",L,!0),document.addEventListener("keydown",L,!0)})(!0);const V=t=>{if(!t||!t.target)return;const e=t.target;let i=E()?r:j?n:l;if(e.closest(D)&&(i=l),i!==l&&U())return;let c=o.VIEW_PRODUCT;e.closest(A)?c=o.QUICK_VIEW:e.closest(I)?c=o.BUY_NOW:e.closest(h)&&(c=o.ADD_TO_CART);let d="";const a=e.closest(_);var u;a?d=a.getAttribute("id")||"":c!=o.ADD_TO_CART&&c!=o.BUY_NOW||(d=null===(u=e.closest(O))||void 0===u?void 0:u.getAttribute("product-id"));if(!d)return;if(e.closest(O)){const t=N(s);t&&d===t.pid&&(i=l)}const v={};if(i===l){const t=e.closest(D),o=null==t?void 0:t.parentNode;if(null==o?void 0:o.id){var g,p,f;const t=null===(g=o.id)||void 0===g?void 0:g.replace("boost-sd-widget-",""),e=null===(p=o.classList[0])||void 0===p?void 0:p.replace("boost-sd-","");v.wid=t,v.rt=e;const n=N("boostSDRequestIdMoreInformationKey");if((null===(f=Object.keys(n))||void 0===f?void 0:f.length)>0){var m;const e=Object.keys(n).find((e=>n[e].wid===t));!v.rt&&n[e]&&(v.rt=null===(m=n[e])||void 0===m?void 0:m.rt),v.rid=e,q(s,{rid:e,wid:v.wid,rt:v.rt,pid:d})}}}if(U()&&[o.ADD_TO_CART,o.BUY_NOW].includes(c))return;const b=K(d,c,i,v);B(b),$(b,[o.ADD_TO_CART,o.BUY_NOW].includes(c))};console.log("register event initCollectionSearchPage"),document.addEventListener("click",V,!0);const Y=t=>{if(!t||!t.target)return;const e=t.target,n=e.closest(I);if(e.closest(h)||function(t){var e;if(!t)return!1;const o=(null==t||null===(e=t.innerHTML)||void 0===e?void 0:e.toLowerCase())||"";return["add to cart","add-to-cart","add to bag","add_to_cart","addtocart","data-product-form-add",'name="add"'].some((t=>o.includes(t)))}(e)||n){var r,i,l;let t={pid:null===(l=boostSDAppConfig)||void 0===l||null===(i=l.generalSettings)||void 0===i||null===(r=i.product_id)||void 0===r?void 0:r.toString(),u:n?o.BUY_NOW:o.ADD_TO_CART},s="";const d=e.closest(D);if(d){var c;const e=null===(c=d.parentElement)||void 0===c?void 0:c.id;e&&(s="recommend",t.wid=e.replace("boost-sd-widget-",""))}const a=e.closest(O);if(a){const e=a.getAttribute("product-id");e&&(t.pid=e,s="recommend")}if(t=K(t.pid,t.u,s,t),!t)return;B(t),$(t,!0)}};(()=>{if(!U())return;const t=N(d);t&&($(t,!0),localStorage.removeItem(d)),console.log("register event initOtherPage"),document.addEventListener("click",Y,!0)})()})();
//# sourceMappingURL=boost-sd-analytic.js.map